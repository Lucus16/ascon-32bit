\subsubsection{Substitution Layer}

The substitution layer in Ascon is a 5-bit S-box which is applied in
parallel to 64 sets of 5 bits. The paper describes an instruction
sequence of bitwise operations that will compute this S-box on an entire
machine word in parallel. It takes 5 input words, one for each bit in
the S-box, and produces 5 output words. The instruction sequence
translates to 22 single-cycle instructions. Because these can only be
applied to 32 bits at a time on 32-bit platforms, they need to be run
twice. Therefor, a straightforward implementation takes 44 cycles. The
instruction sequence is as follows:

\begin{verbatim}
x0 ^=  x4;  x4 ^=  x3;  x2 ^=  x1;
t0  = ~x0;  t1  = ~x1;  t2  = ~x2;  t3  = ~x3;  t4  = ~x4;
t0 &=  x1;  t1 &=  x2;  t2 &=  x3;  t3 &=  x4;  t4 &=  x0;
x0 ^=  t1;  x1 ^=  t2;  x2 ^=  t3;  x3 ^=  t4;  x4 ^=  t0;
x1 ^=  x0;  x0 ^=  x4;  x3 ^=  x2;  x2  = ~x2;
\end{verbatim}

The substitution layer can be optimized by computing the same S-box with
a different formula. We derived shorter binary formulas by first writing
down the the bit sequences that occur for each of the 5 output bits for
all 32 inputs. This allowed us to recognize patterns in the bit
sequences. We first eliminated input bits that did not affect the
output, or only affected the output through a single exclusive or
operation. Then, we looked at the remaining bit patterns and found short
and overlapping binary formulas for them. Here, \(o_n\) indicates output
bit \(n\) and \(i_n\) indicates input bit \(n\).

\begin{align}
\\ o_0 & = i_3 \oplus i_4 \oplus (i_1 \vee (i_0 \oplus i_2 \oplus i_4))
\\ o_1 & = i_0 \oplus i_4 \oplus ((i_2 \oplus i_1) \vee (i_3 \oplus i_2))
\\ o_2 & = i_1 \oplus i_2 \oplus (i_3 \vee \neg i_4)
\\ o_3 & = i_1 \oplus i_2 \oplus (i_0 \vee (i_4 \oplus i_3))
\\ o_4 & = i_3 \oplus i_4 \oplus (i_1 \wedge \neg (i_4 \oplus i_0))
\end{align}
